## 进程与线程

**进程**

进程是资源（CPU、内存）分配的基本单位，它是程序执行时的一个实例，程序运行时系统就会创建一个进程，并为它分配资源，然后把该进程放入进程就绪队列，进程调用器选中它的时候就会为它分配CPU时间，程序开始真正的运行。

Linux系统函数fork()可以在父进程中创建一个子进程，这样的话在一个进程接到来自客户端新的请求时就可以复制出一个子进程让其来处理，父进程只需要负责监控请求的到来，然后创建子进程让其去处理，这样就能做到并发处理。

```python
pid = os.fork()
if pid == 0:
    print('子进程:%s,父进程是:%s' % (os.getpid(), os.getppid()))
else:
    print('进程:%s 创建了子进程:%s' % (os.getpid(),pid ))
```

```
进程:27223 创建了子进程:27224
子进程:27224,父进程是:27223
```

fork函数会返回两次结果，因为操作系统会把当前进程的数据复制一遍，然后程序就分两个进程继续运行后面的代码，fork分别在父进程和子进程中返回，在子进程返回的值pid永远是0，在父进程返回的是子进程的进程id。

**线程**

线程是程序执行时的最小单位，一个进程至少包含一个线程，线程间共享进程的所有资源，每个线程有自已的堆栈和局部变量，线程由CPU独立调度执行，在多CPU环境下就允许多个线程同时运行，同样多线程也可以实现并发操作，每个请求分配一个线程来处理。

**线程和进程的区别**

- 进程有自己的独立地址空间，每启动一个进程，系统就会为它分配地址空间，建立数据表来维护代码段、堆栈段和数据段。而线程是共享进程中的数据的，CPU切换一个线程的花费远比进程要小很多。

- 线程间通信更方便，同一进程下的线程共享全局变量、静态变量等数据，而进程之间的通信需要以通信的方式进程。
- 多线程程序只要有一个线程死掉，整个进程也死掉了，而一个进程死掉并不会对另外一个进程造成影响，因为进程有自己独立的地址空间。


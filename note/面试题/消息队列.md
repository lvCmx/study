## 1.如何进行消息队列的技术选型

### 解耦

**不用MQ的系统耦合场景**

![](https://github.com/lvCmx/study/blob/master/note/面试题/resource/不用mq的系统.png)

说明：A系统发送数据到BCDEF各个系统中，接口调用发送，那么此时，如果出现一个系统G也需要这个数据呢？那如果D系统现在不需要了呢？现在A系统又要发送第二种数据了呢？A系统负责人估计已经崩溃了。另外A系统时时刻刻考虑BCDEF系统如果挂了怎么办？要不要重新发送数据等问题。

**使用mq的系统**

![](https://github.com/lvCmx/study/blob/master/note/面试题/resource/mq系统.png)

你需要去考虑一下你负责的系统中是否有类似的场景，就是一个系统或者一个模块，调用了多个系统或者模块，互相之间的调用很复杂，维护起来很麻烦。但是其实这个调用是不需要直接同步调用接口的，如果用MQ给他异步化解耦，也是可以的，你就需要去考虑在你的项目里，是不是可以运用这个MQ去进行系统的解耦。在简历中体现出来这块东西，用MQ作解耦。

### 异步

**不使用mq的系统**

![](https://github.com/lvCmx/study/blob/master/note/面试题/resource/异步-不用mq.png)

A系统接收一个请求，需要在自己本地写库，还需要在BCD三个系统写库，自己本地写库要3ms，BCD三个系统分别写库要300ms、450ms、200ms。最终请求总延时是3 + 300 + 450 + 200 = 953ms，接近1s，用户感觉搞个什么东西，慢死了慢死了。

![](https://github.com/lvCmx/study/blob/master/note/面试题/resource/mq中的异步系统.png)

### 削峰

**没有mq削值把mysql压崩**

![](https://github.com/lvCmx/study/blob/master/note/面试题/resource/削峰-mq01.png)

例如：我们现在有这样一个需要，系统中午的时候，访问的用户比较多，当每秒要操作2000条以上的sql语句时，mysql可能支撑不住，会把数据压跨。

**用mq削峰**

![](https://github.com/lvCmx/study/blob/master/note/面试题/resource/削峰-mq01.png)

## 2.消息队列有什么优点和缺点啊?

优点就是上面所说的三点：解耦、异步、削峰

缺点：

- 系统可用性降低：系统引入的外部依赖越多，越容易挂掉，本来你就是A系统调用BCD三个系统的接口就好了，人ABCD四个系统好好的，没啥问题，你偏加个MQ进来，万一MQ挂了咋整？MQ挂了，整套系统崩溃了，你不就完了么。
- 系统复杂性提高：硬生生加个MQ进来，你怎么保证消息没有重复消费？怎么处理消息丢失的情况？怎么保证消息传递的顺序性？头大头大，问题一大堆，痛苦不已
- 一致性问题：A系统处理完了直接返回成功了，人都以为你这个请求就成功了；但是问题是，要是BCD三个系统那里，BD两个系统写库成功了，结果C系统写库失败了，咋整？你这数据就不一致了。

